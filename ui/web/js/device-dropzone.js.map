{"version":3,"file":"device-dropzone.js","sourceRoot":"","sources":["../../ts/device-dropzone.ts"],"names":[],"mappings":"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","sourcesContent":["import { LitElement, html, css } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\nimport { DeviceDragZone } from './device-dragzone.js';\nimport { simulationState } from './device-observer.js';\n\n@customElement('ns-device-dropzone')\nexport class DeviceDropZone extends LitElement {\n  @property({ type: String, attribute: 'serial' })\n  serial: string = '';\n\n  @property({ type: String, attribute: 'type' })\n  type: string = '';\n\n  static styles = css`\n    :host {\n      cursor: move;\n    }\n  `;\n\n  constructor() {\n    super();\n    this.addEventListener('drop', this.handleDrop);\n    this.addEventListener('drag', this.handleDragOver);\n    this.addEventListener('dragenter', DeviceDropZone.handleDragEnter);\n    this.addEventListener('dragleave', DeviceDropZone.handleDragLeave);\n    this.addEventListener('dragover', this.handleDragOver);\n  }\n\n  static handleDragEnter(ev: DragEvent) {\n    ev.preventDefault();\n  }\n\n  static handleDragLeave(ev: DragEvent) {\n    ev.preventDefault();\n  }\n\n  slottedDropZone() {\n    // Returns the #dropzone div inside the slotted children, where devices are stored.\n    // note: needs better checking when not the first element.\n    const slot = this.shadowRoot?.querySelector('slot');\n    return slot?.assignedElements({ flatten: true })[0];\n  }\n\n  handleDrop(ev: DragEvent) {\n    ev.preventDefault();\n    const dropzone = this.slottedDropZone();\n    if (dropzone) {\n      const draggedElement = DeviceDragZone.dragged as HTMLElement;\n      if (ev.dataTransfer?.effectAllowed === 'move') {\n        draggedElement.parentNode?.removeChild(draggedElement);\n        draggedElement.style.opacity = '';\n        dropzone.appendChild(draggedElement);\n      } else {\n        // copy\n        dropzone.appendChild(draggedElement.cloneNode(true));\n      }\n      const dropped = dropzone.lastChild as HTMLElement;\n      if (dropped) {\n        const rect = (dropzone as HTMLElement).getBoundingClientRect();\n        dropped.setAttribute('action', 'move');\n        dropped.style.position = 'absolute';\n        dropped.style.left = `${ev.clientX - rect.left}px`;\n        dropped.style.top = `${ev.clientY - rect.top}px`;\n        dropped.style.opacity = `1.0`;\n        // Update the position of a dropped element\n        let serial = dropped\n          .getElementsByTagName('ns-cube-sprite')\n          .item(0)\n          ?.getAttribute('id');\n        if (serial === undefined) {\n          serial = dropped\n            .getElementsByTagName('ns-pyramid-sprite')\n            .item(0)\n            ?.getAttribute('id');\n        }\n        if (serial === undefined || serial === null) {\n          serial = '';\n        }\n        simulationState.handleDrop(\n          serial,\n          (ev.clientX - rect.left) / 100,\n          (ev.clientY - rect.top) / 100\n        );\n      }\n    }\n  }\n\n  handleDragOver(ev: DragEvent) {\n    ev.preventDefault();\n    this.slottedDropZone();\n  }\n\n  render() {\n    return html`<slot></slot>`;\n  }\n}\n"]}