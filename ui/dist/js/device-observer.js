class e{constructor(e){this.device=e}get deviceSerial(){return this.device.deviceSerial}get name(){var e;return null!==(e=this.device.name)&&void 0!==e?e:""}set name(e){this.device.name=e}get position(){let e={x:0,y:0,z:0};return"position"in this.device&&this.device.position&&"object"==typeof this.device.position&&("x"in this.device.position&&"number"==typeof this.device.position.x&&(e.x=this.device.position.x),"y"in this.device.position&&"number"==typeof this.device.position.y&&(e.y=this.device.position.y),"z"in this.device.position&&"number"==typeof this.device.position.z&&(e.z=this.device.position.z)),e}set position(e){this.device.position=e}get orientation(){let e={yaw:0,pitch:0,roll:0};return"orientation"in this.device&&this.device.orientation&&"object"==typeof this.device.orientation&&("yaw"in this.device.orientation&&"number"==typeof this.device.orientation.yaw&&(e.yaw=this.device.orientation.yaw),"pitch"in this.device.orientation&&"number"==typeof this.device.orientation.pitch&&(e.pitch=this.device.orientation.pitch),"roll"in this.device.orientation&&"number"==typeof this.device.orientation.roll&&(e.roll=this.device.orientation.roll)),e}set orientation(e){this.device.orientation=e}get chips(){var e;return null!==(e=this.device.chips)&&void 0!==e?e:[]}set chips(e){this.device.chips=e}get visible(){var e;return null===(e=this.device.visible)||void 0===e||e}set visible(e){this.device.visible=e}}const i=new class{constructor(){this.observers=[],this.simulationInfo={devices:[],selectedSerial:"",dimension:{x:10,y:10,z:0}},fetch("http://localhost:7681/get-devices").then((e=>e.json())).then((e=>{this.fetchDevice(e.devices)})).catch((e=>{console.log("Cannot connect to netsim web server",e)}))}fetchDevice(i){for(const t of i)this.simulationInfo.devices.push(new e(t));this.notifyObservers()}updateSelected(e){this.simulationInfo.selectedSerial=e,this.notifyObservers()}handleDrop(e,i,t){for(const o of this.simulationInfo.devices)if(e===o.deviceSerial){o.position.x=i,o.position.y=t,this.updateDevice({device:{deviceSerial:e,position:o.position}});break}}updateDevice(e){fetch("http://localhost:7681/netsim/update-device",{method:"POST",body:JSON.stringify(e)}).then((e=>e.json())).catch((e=>{console.error("Error:",e)})),this.notifyObservers()}updateCapture(e){fetch("http://localhost:7681/netsim/set-packet-capture",{method:"POST",body:JSON.stringify(e)}).then((e=>e.json())).catch((e=>{console.error("Error:",e)})),this.notifyObservers()}registerObserver(e){this.observers.push(e),e.onNotify(this.simulationInfo)}removeObserver(e){const i=this.observers.indexOf(e);this.observers.splice(i,1)}notifyObservers(){for(const e of this.observers)e.onNotify(this.simulationInfo)}getDeviceList(){return this.simulationInfo.devices}};!async function(){let e=0,t=(new Date).getTime();for(;;)if(await fetch("http://localhost:7681/netsim/register-updates").then((e=>e.json())).then((e=>{i.fetchDevice(e.devices)})).catch((i=>{console.log(i),e+=1})),e>=3){if((new Date).getTime()-t<1e3)return void alert("Failed to Connect to netsim");e=0,t=(new Date).getTime()}}();export{e as Device,i as simulationState};
